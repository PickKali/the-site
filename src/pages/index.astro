---
import Layout from "../layouts/Layout.astro";

import { Image } from "astro:assets";
import fumo from "../assets/index/fumo.png";

const modules = import.meta.glob<PostModule>("./posts/*.astro", {
  eager: true,
});
interface PostModule {
  url: string;
  frontmatter?: {
    title?: string;
    addedDate?: string;
    relevantDate?: string;
    tags?: string[];
  };
  post?: {
    title?: string;
    addedDate?: string;
    relevantDate?: string;
    tags?: string[];
  };
}
// so this whole system thing was meant to support mdx but I found myself going to be using .astro for practically all posts.
const normalizedPosts = Object.values(modules).map((p) => ({
  url: "/the-site" + p.url,
  title:
    p.frontmatter?.title ?? p.post?.title ?? "[Kali Forgot To Add A Title]",
  addedDate: new Date(
    p.frontmatter?.addedDate ?? p.post?.addedDate ?? Date.now(),
  ),
  relevantDate: new Date(
    p.frontmatter?.relevantDate ?? p.post?.relevantDate ?? Date.now(),
  ),
  tags: p.frontmatter?.tags ?? p.post?.tags ?? [],
}));
---

<Layout title="PickKali's silly corner" description="Tap here for +1 Silly">
  <section id="sillysection">
    <div id="rotateddiv">
      <Image
        src={fumo}
        alt="Kali, in a fumo plushie form."
        height={400}
        width={400}
      />
    </div>
    <article id="innerarticle">
      <h1>Hi! I'm Kali! And I'm silly!</h1>
      <blockquote id="randomquote"></blockquote>
      <i>This is actually a quote that I have said.</i>
      <br /><br />
      <a role="button" class="lesspadding" href="#posts">Postsâ–¼</a>
    </article>
  </section>
  <section id="serioussection" class="container-float">
    <article>
      <header><h2>Posts</h2></header>
      <section id="posts">
        <div class="toolbox">
          <div>
            <label for="sortselect">Sort by:</label>
            <details class="dropdown" id="sortselect">
              <summary id="sortsummary">Select Sort</summary>
              <ul style="bottom: 100%">
                <li><a href="#posts">Added Date (Descending)</a></li>
                <li><a href="#posts">Added Date (Ascending)</a></li>
                <li><a href="#posts">Based On Date (Descending)</a></li>
                <li><a href="#posts">Based On Date (Ascending)</a></li>
              </ul>
            </details>
          </div>

          <div>
            <label for="tagfilters">Filter by tags:</label>
            <details class="dropdown" id="tagfilters">
              <summary id="tagsummary">Select Tags (Inclusive)</summary>
              <ul style="bottom: 100%">
                {
                  Array.from(new Set(normalizedPosts.flatMap((p) => p.tags)))
                    .sort((a, b) => a.localeCompare(b))
                    .map((tag) => (
                      <li class="dropitem">
                        <label>
                          <input
                            type="checkbox"
                            value={tag}
                            class="tag-checkbox"
                          />
                          {tag}
                        </label>
                      </li>
                    ))
                }
              </ul>
            </details>
          </div>
        </div>
        <ul id="postlist" class="toolbox"></ul>
      </section>
      <footer>
        <small
          >Based On? Based On What? <br />
          <i
            >The "Based On" date is when it was related to me. A lot of these
            posts are retrospective, so this date is listed.</i
          ><small></small>
        </small>
      </footer>
    </article>

    <script is:inline define:vars={{ normalizedPosts }}>
      window.__POSTS__ = normalizedPosts;
    </script>

    <script src="../scripts/index.js"></script>

    <style>
      html {
        background-image:
          linear-gradient(
            to right,
            var(--K),
            #00000000 20%,
            #00000000 80%,
            var(--L)
          ),
          url("/k&.png"), linear-gradient(to right, var(--K), var(--L));
        background-size: auto, 80px, auto;
        background-repeat: repeat, repeat, repeat;
        animation: panning 10s ease-in-out infinite;
        animation-direction: alternate;
      }

      @keyframes panning {
        0% {
          background-position:
            0% 0%,
            0% 0%,
            0% 0%;
        }
        100% {
          background-position:
            0% 0%,
            5% 5%,
            0% 0%;
        }
      }

      #innerarticle {
        height: min-content;
        margin-top: auto;
        margin-bottom: auto;
      }
      #sillysection {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        min-height: calc(100vh - 4.5rem);
      }
      #rotateddiv {
        height: min-content;
        width: fit-content;
        margin-top: auto;
        margin-bottom: auto;
        animation: rotateYZ 15s infinite linear;
      }
      #serioussection {
        margin-left: auto;
        margin-right: auto;
        max-width: 1080px;
      }
      .lesspadding {
        padding: 0.5em 1em;
      }
      td {
        line-height: 2em;
      }
      @keyframes rotateYZ {
        to {
          transform: rotateY(360deg) rotateZ(720deg);
        }
      }
      ul li {
        list-style-type: none;
        display: list-item;
        text-align: center;
      }
      .toolbox {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }
      .thumbnail {
        text-decoration: none;
        border: solid 1px;
        margin: 1px;
        border-image: linear-gradient(to right, var(--K), var(--L)) 27;
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 20px;
        transition: transform 0.3s;
      }
      .thumbnail:hover {
        transform: translateY(-2px);
      }
      .content {
        width: 300px;
      }
      @media (max-width: 650px) {
        .thumbnail {
          display: flex;
          align-items: center;
          justify-content: center;
          flex-wrap: wrap;
        }
      }
    </style>
  </section></Layout
>
